{% extends "model-scope.html" %}
{% load static sekizai_tags tutorial_tags %}

{% block addtoblock %}
	{{ block.super }}
	{% addtoblock "css" %}<link href="{% static 'djng/css/fileupload.css' %}" rel="stylesheet" />{% endaddtoblock %}
	{% addtoblock "js" %}<script src="{% static 'node_modules/ng-file-upload/dist/ng-file-upload.js' %}" type="text/javascript"></script>{% endaddtoblock %}
	{% addtoblock "js" %}<script src="{% static 'js/djng-fileupload.js' %}" type="text/javascript"></script>{% endaddtoblock %}
	{% addtoblock "ng-requires" %}djng.fileupload{% endaddtoblock %}
{% endblock addtoblock %}

{% block main-intro %}
<h1>Image Upload Form</h1>
<p class="lead">Drag and drop image into form</p>
<p>This example shows how to upload an image to the server using AngularJS with Ajax.</p>
{% endblock main-intro %}

{% block form_tag %}name="{{ form.form_name }}" method="post" action="." validate ng-controller="MyFormCtrl"{% endblock %}

{% block form_submission %}
	<p>
		<button type="button" class="btn btn-primary" ng-disabled="my_form.$invalid" ng-click="submit()" disabled="disabled">Submit via Ajax</button>
	</p>
	<p><small>Test submission of invalid Form data:</small><br>
		<button type="button" ng-click="submit()" class="btn btn-warning btn-xs">Force Submission via Ajax</button>
	</p>
{% endblock %}

{% block main-tutorial %}
<p>If we want to upload an image to the server through an Ajax request, we have to divide the
submission in two steps. This is because browsers can not serialize file payload into JSON. Instead,
in order to upload files we first must upload the image to the server encoded as
<code>multipart/form-data</code>. The server then creates a temporary copy of that image
and returns a reference to it which is written into a hidden field of our form.</p>
<p>When the form finally is submitted by the client, only the reference to the temporary file
is sent through Ajax. The server then moved the previously uploaded copy of that file into its
<code>MEDIA_ROOT</code> directory and stores its location inside a model field.</p>

<p ng-init="tabList=['Model', 'Form', 'View', 'HTML', 'JavaScript']"></p>
{% endblock main-tutorial %}

{% block main-sample-code %}
{% autoescape off %}
<div ng-show="activeTab==='Model'">{% pygments "models/subscribe.py" %}</div>
<div ng-show="activeTab==='Form'">{% pygments "forms/image_upload.py" %}</div>
<div ng-show="activeTab==='View'">{% pygments "views/image_upload.py" %}</div>
<div ng-show="activeTab==='HTML'">{% pygments "tutorial/model-scope.html" %}</div>
<div ng-show="activeTab==='JavaScript'">{% pygments "static/js/model-scope.js" %}</div>
{% endautoescape %}
<p class="bg-info">Here the differences to the <em>Classic Subscription</em> example is, that the
Form now additionally must inherit from the mixin class <code>NgFormValidationMixin</code>.
Furthermore, the browsers internal Form validation must be disabled. This is achieved by adding
the property <code>novalidate</code> to the Form's HTML element.</p>
{% endblock main-sample-code %}
